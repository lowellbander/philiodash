<!-- index.html -->
<!DOCTYPE html>
<head>
    <title>philio</title>
    <script src="https://fb.me/react-0.13.3.js"></script>
    <script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
</head>
<body>
  <div id="content"></div>
  <script type="text/jsx">
    var UserInfo = React.createClass({
      getInitialState: function () {
        return {
          name: 'No Name',
        };
      },
      componentDidMount: function () {
        var that = this; // TODO
        $.ajax({
          url: 'http://localhost:8080/foo?access_token=' + this.props.token,
          success: function (data) {
            that.setState({name: data.display_name});
          },
        });
      },
      render: function () {
        return <p> {this.state.name} </p>;
      },
    });
    var Dashboard = React.createClass({
      render: function () {
        var access_token = location.hash.split('=')[1];
        if (!access_token) {
          return <a href="http://localhost:8080/login">Login</a>;
        } else {
          return (
            <div>
              <p> The user is logged in </p>
              <UserInfo
                token={access_token}
              />
            </div>
          );
        }
      },
    });
    React.render(
      <Dashboard/>,
      document.getElementById('content')
    );
  </script>
</body>
